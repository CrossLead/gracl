export function noop() { }
export function yes() { return true; }
export function baseCompare(a, b) {
    return Number(a > b) - Number(a < b);
}
export function binaryIndexOf(arr, el, compare = baseCompare) {
    let low = 0, high = arr.length - 1;
    while (low <= high) {
        const pivot = (high + low) >> 1, diff = compare(el, arr[pivot]);
        if (diff > 0)
            low = pivot + 1;
        else if (diff < 0)
            high = pivot - 1;
        else
            return pivot;
    }
    return -1;
}
export function permissionCompare(a, b) {
    return baseCompare(a.subjectId, b.subjectId);
}
export function permissionIndexOf(arr, subjectId) {
    return binaryIndexOf(arr, { subjectId }, permissionCompare);
}
export function getClassOf(node) {
    return Object.getPrototypeOf(node).constructor;
}
export function topologicalSort(nodes, nameKey = 'name', parentKey = 'parent') {
    const nodeList = [], noParentList = [], parentMapping = new Map(), remainingNodes = new Set(nodes.map(n => n[nameKey]));
    const parentCounts = {};
    for (const schemaNode of nodes) {
        const name = schemaNode[nameKey], parentProp = schemaNode[parentKey];
        if (!name) {
            throw new Error(`No ${nameKey} field on node = ${schemaNode}`);
        }
        if (!parentProp) {
            noParentList.push(schemaNode);
            remainingNodes.delete(schemaNode[nameKey]);
            parentCounts[name] = 0;
        }
        else {
            const parents = Array.isArray(parentProp)
                ? parentProp
                : [parentProp];
            parentCounts[name] = parents.length;
            for (let parent of parents) {
                if (!parentMapping.has(parent)) {
                    parentMapping.set(parent, [schemaNode]);
                }
                else {
                    parentMapping.get(parent).push(schemaNode);
                }
            }
        }
    }
    while (noParentList.length) {
        const rootNode = noParentList.pop();
        nodeList.push(rootNode);
        if (parentMapping.has(rootNode[nameKey])) {
            const children = parentMapping.get(rootNode[nameKey]);
            while (children.length) {
                const child = children.pop(), childName = child[nameKey];
                if (--parentCounts[childName] === 0) {
                    remainingNodes.delete(childName);
                    noParentList.push(child);
                }
            }
        }
    }
    if (remainingNodes.size) {
        throw new Error('Schema has a circular dependency or a missing parent! Examine definitions for '
            + [...remainingNodes].map(x => `"${x}"`).join(', '));
    }
    return nodeList;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXRpbC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL2xpYi91dGlsLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUlBLHlCQUF5QixDQUFDO0FBQzFCLHdCQUF3QixNQUFNLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztBQUV0Qyw0QkFBNEIsQ0FBTSxFQUFFLENBQU07SUFDeEMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsTUFBTSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztBQUN2QyxDQUFDO0FBRUQsOEJBQThCLEdBQVUsRUFBRSxFQUFPLEVBQUUsT0FBTyxHQUFHLFdBQVc7SUFDdEUsSUFBSSxHQUFHLEdBQUcsQ0FBQyxFQUNQLElBQUksR0FBRyxHQUFHLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQztJQUUxQixPQUFPLEdBQUcsSUFBSSxJQUFJLEVBQUUsQ0FBQztRQUNuQixNQUFNLEtBQUssR0FBRyxDQUFDLElBQUksR0FBRyxHQUFHLENBQUMsSUFBSSxDQUFDLEVBQ3pCLElBQUksR0FBSSxPQUFPLENBQUMsRUFBRSxFQUFFLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO1FBRXRDLEVBQUUsQ0FBQyxDQUFDLElBQUksR0FBRyxDQUFDLENBQUM7WUFBTyxHQUFHLEdBQUksS0FBSyxHQUFHLENBQUMsQ0FBQztRQUNyQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsSUFBSSxHQUFHLENBQUMsQ0FBQztZQUFFLElBQUksR0FBRyxLQUFLLEdBQUcsQ0FBQyxDQUFDO1FBQ3JDLElBQUk7WUFBZ0IsTUFBTSxDQUFDLEtBQUssQ0FBQztJQUNuQyxDQUFDO0lBRUQsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBQ1osQ0FBQztBQUVELGtDQUFrQyxDQUFhLEVBQUUsQ0FBYTtJQUM1RCxNQUFNLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxTQUFTLEVBQUUsQ0FBQyxDQUFDLFNB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