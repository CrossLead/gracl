export function noop() { }
export function yes() { return true; }
export function baseCompare(a, b) {
    return Number(a > b) - Number(a < b);
}
export function binaryIndexOf(arr, el, compare = baseCompare) {
    let low = 0, high = arr.length - 1;
    while (low <= high) {
        const pivot = (high + low) >> 1, diff = compare(el, arr[pivot]);
        if (diff > 0)
            low = pivot + 1;
        else if (diff < 0)
            high = pivot - 1;
        else
            return pivot;
    }
    return -1;
}
export function permissionCompare(a, b) {
    return baseCompare(a.subjectId, b.subjectId);
}
export function permissionIndexOf(arr, subjectId) {
    return binaryIndexOf(arr, { subjectId }, permissionCompare);
}
export function getClassOf(node) {
    return Object.getPrototypeOf(node).constructor;
}
export function topologicalSort(nodes, nameKey = 'name', parentKey = 'parent') {
    const nodeList = [], noParentList = [], parentMapping = new Map(), remainingNodes = new Set(nodes.map(n => n[nameKey]));
    for (const schemaNode of nodes) {
        const name = schemaNode[nameKey], parent = schemaNode[parentKey];
        if (!name) {
            throw new Error(`No ${nameKey} field on node = ${schemaNode}`);
        }
        if (!parent) {
            noParentList.push(schemaNode);
            remainingNodes.delete(schemaNode[nameKey]);
        }
        else {
            if (!parentMapping.has(parent)) {
                parentMapping.set(parent, [schemaNode]);
            }
            else {
                parentMapping.get(parent).push(schemaNode);
            }
        }
    }
    while (noParentList.length) {
        const rootNode = noParentList.pop();
        nodeList.push(rootNode);
        if (parentMapping.has(rootNode[nameKey])) {
            const children = parentMapping.get(rootNode[nameKey]);
            while (children.length) {
                const child = children.pop();
                remainingNodes.delete(child[nameKey]);
                noParentList.push(child);
            }
        }
    }
    if (remainingNodes.size) {
        throw new Error('Schema has a circular dependency or a missing parent! Examine definitions for '
            + [...remainingNodes].map(x => `"${x}"`).join(', '));
    }
    return nodeList;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXRpbC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL2xpYi91dGlsLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUlBLHlCQUF5QixDQUFDO0FBQzFCLHdCQUF3QixNQUFNLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztBQUV0Qyw0QkFBNEIsQ0FBTSxFQUFFLENBQU07SUFDeEMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsTUFBTSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztBQUN2QyxDQUFDO0FBRUQsOEJBQThCLEdBQVUsRUFBRSxFQUFPLEVBQUUsT0FBTyxHQUFHLFdBQVc7SUFDdEUsSUFBSSxHQUFHLEdBQUcsQ0FBQyxFQUNQLElBQUksR0FBRyxHQUFHLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQztJQUUxQixPQUFPLEdBQUcsSUFBSSxJQUFJLEVBQUUsQ0FBQztRQUNuQixNQUFNLEtBQUssR0FBRyxDQUFDLElBQUksR0FBRyxHQUFHLENBQUMsSUFBSSxDQUFDLEVBQ3pCLElBQUksR0FBSSxPQUFPLENBQUMsRUFBRSxFQUFFLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO1FBRXRDLEVBQUUsQ0FBQyxDQUFDLElBQUksR0FBRyxDQUFDLENBQUM7WUFBTyxHQUFHLEdBQUksS0FBSyxHQUFHLENBQUMsQ0FBQztRQUNyQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsSUFBSSxHQUFHLENBQUMsQ0FBQztZQUFFLElBQUksR0FBRyxLQUFLLEdBQUcsQ0FBQyxDQUFDO1FBQ3JDLElBQUk7WUFBZ0IsTUFBTSxDQUFDLEtBQUssQ0FBQztJQUNuQyxDQUFDO0lBRUQsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBQ1osQ0FBQztBQUVELGtDQUFrQyxDQUFhLEVBQUUsQ0FBYTtJQUM1RCxNQUFNLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxTQUFTLEVBQUUsQ0FBQyxDQUFDLFNB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